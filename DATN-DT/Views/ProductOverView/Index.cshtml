@{
    ViewData["Title"] = "Product Overview";
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Product Overview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body {
            background-color: #12121d;
            color: white;
            font-family: 'Segoe UI', sans-serif;
        }

        .container {
            margin-top: 30px;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #f5f5f5;
        }

        table {
            background-color: #1e1e2a;
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background-color: #2b2b33;
            color: #fff;
            border: none;
        }

        td {
            color: #ddd;
            border-color: #444;
        }

        .btn-create {
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            transition: 0.3s;
        }

            .btn-create:hover {
                background-color: #357ab8;
            }

        .modal-content {
            background-color: #2b2b33;
            color: white;
            border-radius: 10px;
        }

        .form-control {
            background-color: #1e1e2a;
            color: white;
            border: 1px solid #444;
        }

            .form-control:focus {
                border-color: #4a90e2;
                box-shadow: none;
            }

            .form-control::placeholder {
                color: #ffffff !important;
                opacity: 0.7 !important;
            }

        .text-danger {
            color: #ff4d4d !important;
        }

        .price-highlight {
            color: #28a745;
            font-weight: bold;
        }

        .text-muted {
            color: #6c757d !important;
            font-style: italic;
        }

        .search-container {
            background-color: #1e1e2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .search-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .search-main-input {
            flex: 1;
            max-width: 500px;
        }

        .search-filters {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-filter-item {
            width: 180px;
        }

        .search-actions {
            display: flex;
            gap: 8px;
        }

        .btn-search {
            padding: 8px 16px;
        }

        .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .badge-success {
            background-color: #28a745;
        }

        .badge-danger {
            background-color: #dc3545;
        }

        .badge-secondary {
            background-color: #6c757d;
        }

        .btn-group .btn {
            margin: 2px;
        }

        .btn-info {
            background-color: #17a2b8;
            border-color: #17a2b8;
        }

            .btn-info:hover {
                background-color: #138496;
                border-color: #138496;
            }

        .btn-edit-overview {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #212529;
        }

            .btn-edit-overview:hover {
                background-color: #e0a800;
                border-color: #e0a800;
                color: #212529;
            }

        .btn-delete {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

            .btn-delete:hover {
                background-color: #c82333;
                border-color: #bd2130;
                color: white;
            }

        .table-hover tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.075);
        }

        .img-thumbnail {
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #1e1e2a;
        }

        .card {
            background-color: #1e1e2a;
            border: 1px solid #444;
            border-radius: 10px;
        }

        .card-header {
            background-color: #2b2b33;
            border-bottom: 1px solid #444;
            color: #fff;
        }

        .form-label {
            color: #ddd;
            font-weight: 500;
        }

        /* Stock status styles */
        .stock-status {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.875em;
            display: inline-block;
            min-width: 80px;
        }

        .in-stock {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .out-of-stock {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

            .loading-spinner i {
                font-size: 2rem;
                color: #4a90e2;
            }

        /* Real-time update indicator */
        .update-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }

        .update-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background-color: #ffc107;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @@keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @@keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .stock-updated {
            background-color: rgba(40, 167, 69, 0.1) !important;
            animation: highlightRow 2s ease-out;
        }

        @@keyframes highlightRow {
            0% {
                background-color: rgba(40, 167, 69, 0.3);
            }

            100% {
                background-color: rgba(40, 167, 69, 0.1);
            }
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background-color: #1e1e2a;
            border: 1px solid #444;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Responsive adjustments */
        @@media (max-width: 1200px) {
            .search-input-group {
                flex-wrap: wrap;
            }

            .search-main-input {
                max-width: 100%;
                margin-bottom: 10px;
            }

            .search-filters {
                flex: 1;
                justify-content: space-between;
            }
        }

        @@media (max-width: 768px) {
            .search-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .search-input-group {
                flex-direction: column;
            }

            .search-main-input {
                width: 100%;
            }

            .search-filters {
                flex-direction: column;
                width: 100%;
            }

            .search-filter-item {
                width: 100%;
            }

            .search-actions {
                justify-content: center;
                width: 100%;
                margin-top: 10px;
            }

            .btn-group {
                flex-direction: column;
            }

                .btn-group .btn {
                    margin: 2px 0;
                }

            .update-indicator {
                top: 5px;
                right: 5px;
                font-size: 0.7rem;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Product Overview</h2>

        <!-- Real-time update indicator -->
        <div id="updateIndicator" class="update-indicator d-none">
            <i class="fas fa-sync-alt fa-spin"></i>
            <span id="updateMessage">Đang cập nhật...</span>
            <div class="update-badge"></div>
        </div>

        <!-- Search Container -->
        <div class="search-container">
            <div class="search-header">
                <h4 class="mb-0">Tìm kiếm sản phẩm</h4>
                <button class="btn btn-create" onclick="loadProducts()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <div class="search-input-group">
                <!-- Input search chính -->
                <input type="text" id="searchTerm" class="form-control search-main-input" placeholder="Nhập tên sản phẩm hoặc thương hiệu để tìm kiếm..." />

                <!-- Các filter bên phải -->
                <div class="search-filters">
                    <select class="form-control search-filter-item" id="brandFilter">
                        <option value="">Tất cả thương hiệu</option>
                    </select>
                    <input type="number" class="form-control search-filter-item" id="minPrice" placeholder="Giá tối thiểu" />
                    <input type="number" class="form-control search-filter-item" id="maxPrice" placeholder="Giá tối đa" />

                    <!-- Actions -->
                    <div class="search-actions">
                        <button class="btn btn-primary btn-search" onclick="loadProducts()">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="btn btn-secondary btn-search" onclick="resetSearchForm()">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Table -->
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Danh sách sản phẩm</h5>
                <div class="text-muted" style="font-size: 0.875rem;">
                    <i class="fas fa-clock"></i> Cập nhật: <span id="lastUpdateTime">--:--:--</span>
                </div>
            </div>
            <div class="card-body">
                <div class="loading-spinner" id="loadingSpinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p class="mt-2">Đang tải sản phẩm...</p>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover text-center align-middle" id="productTable">
                        <thead>
                            <tr>
                                <th>Ảnh</th>
                                <th>Tên Model</th>
                                <th>Thương hiệu</th>
                                <th>Màu sắc</th>
                                <th>Giá bán</th>
                                <th>Số lượng tồn</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // ========== GLOBAL VARIABLES
        let allProducts = [];
        let lastUpdateTimestamp = 0;
        let productUpdateInterval;

        // ========== INITIALIZATION
        document.addEventListener('DOMContentLoaded', function () {
            loadBrands();
            loadProducts();
            setupEventListeners();
            startUpdateChecking();
            updateLastUpdateTime();
        });

        // ========== SETUP EVENT LISTENERS
        function setupEventListeners() {
            // Real-time search
            document.getElementById('searchTerm').addEventListener('input', function (e) {
                if (e.target.value.length >= 3 || e.target.value.length === 0) {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => loadProducts(), 500);
                }
            });

            // Filter listeners
            document.getElementById('brandFilter').addEventListener('change', loadProducts);
            document.getElementById('minPrice').addEventListener('change', loadProducts);
            document.getElementById('maxPrice').addEventListener('change', loadProducts);
        }

        // ========== RESET SEARCH FORM
        function resetSearchForm() {
            document.getElementById('searchTerm').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            loadProducts();
            showToast('Đã reset bộ lọc tìm kiếm', 'info');
        }

        // ========== BRAND MANAGEMENT
        async function loadBrands() {
            try {
                const response = await fetch('@Url.Action("GetBrands", "ProductOverview")');
                if (!response.ok) throw new Error('Network response was not ok');

                const brands = await response.json();
                const brandFilter = document.getElementById('brandFilter');

                brands.forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand.idThuongHieu;
                    option.textContent = brand.tenThuongHieu;
                    brandFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading brands:', error);
                showToast('Lỗi khi tải thương hiệu: ' + error.message, 'danger');
            }
        }

        // ========== PRODUCT MANAGEMENT
        async function loadProducts() {
            showLoading(true);

            try {
                const searchTerm = document.getElementById('searchTerm').value;
                const brandId = document.getElementById('brandFilter').value;
                const minPrice = document.getElementById('minPrice').value;
                const maxPrice = document.getElementById('maxPrice').value;

                let url = '@Url.Action("SearchProducts", "ProductOverview")?';
                const params = new URLSearchParams();

                if (searchTerm) params.append('searchTerm', searchTerm);
                if (brandId) params.append('brandId', brandId);
                if (minPrice) params.append('minPrice', minPrice);
                if (maxPrice) params.append('maxPrice', maxPrice);

                const response = await fetch(url + params.toString());
                if (!response.ok) throw new Error('Network response was not ok');

                const products = await response.json();
                allProducts = products;
                renderProducts(products);
                updateLastUpdateTime();

            } catch (error) {
                console.error('Error loading products:', error);
                showToast('Lỗi khi tải sản phẩm: ' + error.message, 'danger');
            } finally {
                showLoading(false);
            }
        }

        function renderProducts(products) {
            const tbody = document.getElementById('productTableBody');
            tbody.innerHTML = '';

            if (!products || products.length === 0) {
                tbody.innerHTML = `
                                            <tr>
                                                <td colspan="8" class="text-center py-4">
                                                    <i class="fas fa-box-open fa-2x mb-3 text-muted"></i>
                                                    <p class="text-muted">Không tìm thấy sản phẩm nào</p>
                                                </td>
                                            </tr>`;
                return;
            }

            products.forEach(product => {
                const row = document.createElement('tr');
                row.setAttribute('data-product-id', product.idModelSanPham);

                // Stock status
                const stockStatus = product.soLuongTonKho > 0 ? 'Còn hàng' : 'Hết hàng';
                const stockStatusClass = product.soLuongTonKho > 0 ? 'in-stock' : 'out-of-stock';

                // Image or placeholder
                const productImage = product.anhSanPham && product.anhSanPham !== '/images/default-product.png'
                    ? product.anhSanPham
                    : 'https://via.placeholder.com/60x60/2b2b33/666666?text=No+Image';

                row.innerHTML = `
                                            <td>
                                                <img src="${productImage}" alt="${escapeHtml(product.tenModel)}"
                                                     class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;"
                                                     onerror="this.src='https://via.placeholder.com/60x60/2b2b33/666666?text=No+Image'">
                                            </td>
                                            <td class="fw-bold">${escapeHtml(product.tenModel)}</td>
                                            <td>${escapeHtml(product.tenHang)}</td>
                                            <td>${escapeHtml(product.mau)}</td>
                                            <td class="price-highlight">${formatCurrency(product.giaBan)}</td>
                                            <td>
                                                <span class="fw-bold ${product.soLuongTonKho > 0 ? 'text-success' : 'text-danger'} stock-quantity"
                                                      id="stock-${product.idModelSanPham}" data-current="${product.soLuongTonKho}">
                                                    ${product.soLuongTonKho}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="stock-status ${stockStatusClass}" id="status-${product.idModelSanPham}">
                                                    ${stockStatus}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="btn-group">
                                                    <button class="btn btn-info btn-sm" onclick="viewDetail(${product.idModelSanPham})"
                                                            title="Xem chi tiết">
                                                        <i class="fas fa-eye"></i> Chi tiết
                                                    </button>
                                                    <button class="btn btn-edit-overview btn-sm" onclick="editProduct(${product.idModelSanPham})"
                                                            title="Chỉnh sửa">
                                                        <i class="fas fa-edit"></i> Sửa
                                                    </button>
                                                    <button class="btn btn-delete btn-sm" onclick="deleteProduct(${product.idModelSanPham})"
                                                            title="Xóa sản phẩm">
                                                        <i class="fas fa-trash"></i> Xóa
                                                    </button>
                                                </div>
                                            </td>
                                        `;

                tbody.appendChild(row);
            });
        }

        // ========== REAL-TIME UPDATE
        function startUpdateChecking() {
            // Kiểm tra cập nhật mỗi 5 giây
            productUpdateInterval = setInterval(async () => {
                await checkForProductUpdates();
            }, 5000); // 5 giây
        }

        async function checkForProductUpdates() {
            try {
                // Kiểm tra xem có đang ở trang ProductOverview không
                if (!window.location.pathname.includes('/ProductOverview')) {
                    // Dừng interval nếu không ở trang ProductOverview
                    if (productUpdateInterval) {
                        clearInterval(productUpdateInterval);
                        productUpdateInterval = null;
                    }
                    return;
                }

                const response = await fetch(`/ProductOverview/CheckForProductUpdates?lastCheckTimestamp=${lastUpdateTimestamp}`);
                
                // Nếu response là redirect (301, 302, 307, 308) hoặc 401, 403 thì dừng
                if (response.status === 301 || response.status === 302 || response.status === 307 || 
                    response.status === 308 || response.status === 401 || response.status === 403) {
                    if (productUpdateInterval) {
                        clearInterval(productUpdateInterval);
                        productUpdateInterval = null;
                    }
                    return;
                }
                
                if (!response.ok) return;

                const data = await response.json();

                if (data.hasUpdates && data.updates && data.updates.length > 0) {
                    // Có cập nhật mới
                    lastUpdateTimestamp = data.currentTimestamp;

                    // Hiển thị indicator
                    showUpdateIndicator('Đang cập nhật danh sách sản phẩm...');

                    // Cập nhật từng sản phẩm
                    for (const update of data.updates) {
                        await updateSingleProduct(update.productId);
                    }

                    // Ẩn indicator sau 2 giây
                    setTimeout(() => {
                        hideUpdateIndicator();
                    }, 2000);
                }
            } catch (error) {
                console.error('Error checking for updates:', error);
            }
        }

        async function updateSingleProduct(productId) {
            try {
                // Lấy thông tin stock mới nhất
                const stockResponse = await fetch(`/ProductOverview/GetProductStock?productId=${productId}`);
                if (!stockResponse.ok) return;

                const stockData = await stockResponse.json();
                const newStock = stockData.stockQuantity || 0;

                // Tìm product trong mảng allProducts
                const productIndex = allProducts.findIndex(p => p.idModelSanPham === productId);
                if (productIndex !== -1) {
                    const oldStock = allProducts[productIndex].soLuongTonKho;
                    allProducts[productIndex].soLuongTonKho = newStock;
                }

                // Cập nhật UI
                updateProductStockInUI(productId, newStock);

            } catch (error) {
                console.error(`Error updating product ${productId}:`, error);
            }
        }

        function updateProductStockInUI(productId, newStock) {
            const stockElement = document.getElementById(`stock-${productId}`);
            const rowElement = document.querySelector(`tr[data-product-id="${productId}"]`);

            if (!stockElement || !rowElement) return;

            const oldStock = parseInt(stockElement.getAttribute('data-current') || stockElement.textContent) || 0;

            // Cập nhật số lượng
            stockElement.textContent = newStock;
            stockElement.setAttribute('data-current', newStock);

            // Cập nhật màu sắc
            if (newStock > 0) {
                stockElement.classList.remove('text-danger');
                stockElement.classList.add('text-success');
            } else {
                stockElement.classList.remove('text-success');
                stockElement.classList.add('text-danger');
            }

            // Cập nhật trạng thái
            const statusElement = document.getElementById(`status-${productId}`);
            if (statusElement) {
                const newStatus = newStock > 0 ? 'Còn hàng' : 'Hết hàng';
                const newStatusClass = newStock > 0 ? 'in-stock' : 'out-of-stock';

                statusElement.textContent = newStatus;
                statusElement.className = `stock-status ${newStatusClass}`;
            }

            // Hiệu ứng cập nhật
            if (newStock !== oldStock) {
                rowElement.classList.add('stock-updated');

                // Hiển thị thông báo
                const product = allProducts.find(p => p.idModelSanPham === productId);
                const productName = product ? product.tenModel : `Sản phẩm ${productId}`;

                const change = newStock - oldStock;
                let message = '';

                if (change > 0) {
                    message = `<strong>${productName}</strong>: Tồn kho tăng từ ${oldStock} lên ${newStock} (+${change})`;
                } else if (change < 0) {
                    message = `<strong>${productName}</strong>: Tồn kho giảm từ ${oldStock} xuống ${newStock} (${change})`;
                }

                if (message) {
                    showToast(message, newStock > 0 ? 'success' : 'warning');
                }

                // Xóa class highlight sau 2 giây
                setTimeout(() => {
                    rowElement.classList.remove('stock-updated');
                }, 2000);
            }
        }


        window.notifyImeiUpdate = function (productId) {
            console.log('Received IMEI update notification for product:', productId);

            // Cập nhật ngay lập tức
            updateSingleProduct(productId);

            // Gọi API để thông báo server
            fetch('/ProductOverview/NotifyImeiUpdate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId,
                    action: 'update',
                    timestamp: new Date().toISOString()
                })
            }).then(response => {
                if (response.ok) {
                    console.log('Stock update notification sent successfully');
                }
            }).catch(error => {
                console.error('Error sending stock update:', error);
            });
        };

        // ========== UPDATE INDICATOR FUNCTIONS
        function showUpdateIndicator(message) {
            const indicator = document.getElementById('updateIndicator');
            const messageElement = document.getElementById('updateMessage');

            if (indicator && messageElement) {
                messageElement.textContent = message;
                indicator.classList.remove('d-none');
            }
        }

        function hideUpdateIndicator() {
            const indicator = document.getElementById('updateIndicator');
            if (indicator) {
                indicator.classList.add('d-none');
            }
        }

        // ========== NOTIFICATIONS
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');

            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type === 'danger' ? 'danger' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.id = toastId;

            toast.innerHTML = `
                                        <div class="d-flex">
                                            <div class="toast-body">
                                                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'warning' ? 'fa-exclamation-triangle' : type === 'danger' ? 'fa-times-circle' : 'fa-info-circle'} me-2"></i>
                                                ${message}
                                            </div>
                                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                                        </div>
                                    `;

            toastContainer.appendChild(toast);

            const bsToast = new bootstrap.Toast(toast, {
                animation: true,
                autohide: true,
                delay: 4000
            });
            bsToast.show();

            toast.addEventListener('hidden.bs.toast', function () {
                toast.remove();
            });
        }

        // ========== UTILITY FUNCTIONS
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (show) {
                spinner.style.display = 'block';
            } else {
                spinner.style.display = 'none';
            }
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            document.getElementById('lastUpdateTime').textContent = timeString;
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // ========== PRODUCT ACTIONS
        function viewDetail(idModelSanPham) {
            window.location.href = '/ProductOverview/Details/' + idModelSanPham;
        }

        function editProduct(idModelSanPham) {
            showToast('Chức năng chỉnh sửa sản phẩm với ID: ' + idModelSanPham + ' chưa được triển khai.', 'info');
        }

        function deleteProduct(idModelSanPham) {
            if (confirm('Bạn có chắc chắn muốn xóa sản phẩm với ID: ' + idModelSanPham + '?')) {
                showToast('Xóa sản phẩm với ID: ' + idModelSanPham + ' (Chức năng chưa triển khai)', 'info');
            }
        }

        // ========== CLEANUP
        window.addEventListener('beforeunload', function () {
            if (productUpdateInterval) {
                clearInterval(productUpdateInterval);
            }
        });
    </script>
</body>
</html>